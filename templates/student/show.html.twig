{% set resources = resources|merge({ ckeditor : true, operations : true, uploadfile : true }) %}
{% trans_default_domain 'student' %}
{% extends "student/common.html.twig" %}

{% set title = "title.show"|trans({'%name%': student}) %}

{% set breadcrumbs = { ('' ~ title) : path('app_student_show', {id : student.id })}|merge(breadcrumbs|default({})) %}

{% block body %}
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {# Student Information Panel #}
        <div class="lg:col-span-2">
            <div class="bg-white shadow-sm rounded-lg border {{ student.enable ? 'border-gray-200' : 'border-red-300' }} overflow-hidden">
                {# Header #}
                <div class="px-6 py-4 border-b {{ student.enable ? 'border-gray-200 bg-gray-50' : 'border-red-200 bg-red-50' }}">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold {{ student.enable ? 'text-gray-900' : 'text-red-900' }}">
                            {{ ux_icon('bi:person-circle', {class: 'w-5 h-5 mr-2 inline'}) }}
                            {{ 'show.info.title'|trans }}
                        </h3>
                        {% if is_granted('ROLE_ADMIN') %}
                            <a href="{{ path('app_student_edit_status', { id : student.id, enable : student.enable ? false : true, redirect : true}) }}"
                               class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm
                                      {{ student.enable ? 'text-red-700 bg-red-100 hover:bg-red-200' : 'text-green-700 bg-green-100 hover:bg-green-200' }}
                                      transition-colors duration-200">
                                {% if student.enable %}
                                    {{ ux_icon('bi:toggle-off', {class: 'w-4 h-4 mr-1'}) }}
                                    {{ 'btn.disable'|trans }}
                                {% else %}
                                    {{ ux_icon('bi:toggle-on', {class: 'w-4 h-4 mr-1'}) }}
                                    {{ 'btn.enable'|trans }}
                                {% endif %}
                            </a>
                        {% endif %}
                    </div>
                </div>

                {# Body #}
                <div class="p-6">
                    {# Family Status Alert #}
                    <div class="mb-6">
                        {% if student.family|default(null) is not empty %}
                            <div class="flex items-center p-4 bg-green-50 border border-green-200 rounded-lg">
                                {{ ux_icon('bi:people-fill', {class: 'w-5 h-5 text-green-600 mr-3'}) }}
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-green-800">
                                        {{ 'show.family.label'|trans }}
                                    </p>
                                    <p class="text-sm text-green-700">
                                        <a href="{{ path('app_family_show', {id : student.family.id }) }}"
                                           class="font-medium hover:underline">
                                            {{ student.family }}
                                        </a>
                                    </p>
                                </div>
                            </div>
                        {% else %}
                            <div class="flex items-center p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                {{ ux_icon('bi:exclamation-triangle-fill', {class: 'w-5 h-5 text-yellow-600 mr-3'}) }}
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-yellow-800">
                                        {{ 'show.family.nothing'|trans }}
                                    </p>
                                    <p class="text-sm text-yellow-700">
                                        <a href="{{ path('app_student_edit', { id : student.id }) }}"
                                           class="font-medium hover:underline">
                                            Associer une famille
                                        </a>
                                    </p>
                                </div>
                            </div>
                        {% endif %}
                    </div>

                    {% set studentImage = student.image is not empty ? asset(student.image.getWebPathPreview()) : null %}

                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                        <div class="xl:col-span-1 space-y-4">
                            <div class="relative overflow-hidden rounded-2xl border border-gray-200 shadow-sm bg-slate-900 text-white">
                                {% if studentImage %}
                                    <img src="{{ studentImage }}" alt="{{ student.nameComplete }}" class="h-72 w-full object-cover">
                                {% else %}
                                    <div class="h-72 w-full flex flex-col items-center justify-center bg-gradient-to-br from-indigo-600 via-blue-500 to-purple-500">
                                        {{ ux_icon('bi:person', {class: 'w-16 h-16 text-white/80'}) }}
                                        <span class="mt-3 text-sm font-medium text-white/80">Photo non disponible</span>
                                    </div>
                                {% endif %}

                                <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-5">
                                    <p class="text-xs uppercase tracking-wide text-white/70">Fiche élève</p>
                                    <p class="text-lg font-semibold">{{ student.nameComplete }}</p>
                                    {% if student.grade is not empty %}
                                        <p class="mt-1 text-sm text-white/80 flex items-center gap-2">
                                            {{ ux_icon('bi:mortarboard', {class: 'w-4 h-4'}) }}
                                            {{ student.grade.name }}
                                        </p>
                                    {% endif %}
                                </div>

                                <div class="absolute top-4 left-4">
                                    <a href="{{ path('app_student_edit', { id: student.id }) }}"
                                       class="inline-flex items-center gap-1 rounded-full bg-white/90 px-3 py-1 text-xs font-medium text-gray-700 shadow-sm hover:bg-white">
                                        {{ ux_icon('bi:pencil-square', {class: 'w-4 h-4'}) }}
                                        Modifier le profil
                                    </a>
                                </div>

                                <div class="absolute top-4 right-4">
                                    <span class="inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold {{ student.enable ? 'bg-emerald-500/15 text-emerald-100 ring-1 ring-inset ring-emerald-400/60' : 'bg-rose-500/15 text-rose-100 ring-1 ring-inset ring-rose-400/60' }}">
                                        {{ ux_icon(student.enable ? 'bi:check-circle' : 'bi:slash-circle', {class: 'w-4 h-4'}) }}
                                        {{ student.enable ? 'Actif' : 'Inactif' }}
                                    </span>
                                </div>
                            </div>

                        </div>

                        <div class="xl:col-span-2 space-y-6">
                            <div class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
                                <div class="flex items-center justify-between gap-3">
                                    <h4 class="text-base font-semibold text-gray-900">Informations personnelles</h4>
                                    <span class="text-xs font-medium uppercase tracking-wider text-gray-400">Dernière mise à jour {{ student.updatedAt|default(student.createdAt)|date('d/m/Y') }}</span>
                                </div>

                                <dl class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Nom</dt>
                                        <dd class="mt-1 text-sm font-medium text-gray-900">{{ student.name|default('---') }}</dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Prénom</dt>
                                        <dd class="mt-1 text-sm text-gray-900">{{ student.forname|default('---') }}</dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Sexe</dt>
                                        <dd class="mt-1">
                                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold {{ student.gender == 'male' ? 'bg-blue-100 text-blue-700' : 'bg-pink-100 text-pink-700' }}">
                                                {{ ux_icon(student.gender == 'male' ? 'bi:gender-male' : 'bi:gender-female', {class: 'w-3 h-3 mr-1'}) }}
                                                {{ student.genderCode|default('---') }}
                                            </span>
                                        </dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Date de naissance</dt>
                                        <dd class="mt-1 text-sm text-gray-900">
                                            {{ student.birthday is not empty ? student.birthday|date('d/m/Y') : '---' }}
                                            {% if student.birthday is not empty %}
                                                <span class="ml-2 inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600">
                                                    {{ ux_icon('bi:calendar-event', {class: 'w-3 h-3'}) }}
                                                    {{ student.getAge() }} ans
                                                </span>
                                            {% endif %}
                                        </dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Lieu de naissance</dt>
                                        <dd class="mt-1 text-sm text-gray-900">{{ student.birthplace|default('---') }}</dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Niveau</dt>
                                        <dd class="mt-1">
                                            {% if student.grade is not empty %}
                                                <span class="inline-flex items-center gap-1 rounded-md bg-purple-100 px-2.5 py-1 text-xs font-semibold text-purple-700">
                                                    {{ ux_icon('bi:mortarboard', {class: 'w-4 h-4'}) }}
                                                    {{ student.grade.name }}
                                                </span>
                                            {% else %}
                                                <span class="text-sm text-gray-400">---</span>
                                            {% endif %}
                                        </dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">E-mail</dt>
                                        <dd class="mt-1 text-sm text-gray-900">
                                            {% if student.email %}
                                                <a href="mailto:{{ student.email }}" class="inline-flex items-center gap-2 text-primary-600 hover:text-primary-500">
                                                    {{ ux_icon('bi:envelope', {class: 'w-4 h-4'}) }}
                                                    {{ student.email }}
                                                </a>
                                            {% else %}
                                                <span class="text-gray-400">---</span>
                                            {% endif %}
                                        </dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Téléphones</dt>
                                        <dd class="mt-1">
                                            {% set phones = student.listPhones %}
                                            {% if phones is not empty %}
                                                <div class="flex flex-wrap gap-2">
                                                    {% for phone in phones %}
                                                        <a href="tel:{{ phone }}" class="inline-flex items-center gap-1 rounded-full bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-700 hover:bg-gray-200">
                                                            {{ ux_icon('bi:telephone', {class: 'w-3 h-3'}) }}
                                                            {{ phone }}
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <span class="text-sm text-gray-400">---</span>
                                            {% endif %}
                                        </dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Adresse</dt>
                                        <dd class="mt-1 text-sm text-gray-900">
                                            {% if student.address or student.city or student.zip %}
                                                {% set addressLine = [] %}
                                                {% if student.zip %}
                                                    {% set addressLine = addressLine|merge([student.zip]) %}
                                                {% endif %}
                                                {% if student.city %}
                                                    {% set addressLine = addressLine|merge([student.city]) %}
                                                {% endif %}
                                                <div class="space-y-0.5">
                                                    {% if student.address %}
                                                        <p>{{ student.address }}</p>
                                                    {% endif %}
                                                    {% if addressLine is not empty %}
                                                        <p>{{ addressLine|join(' ') }}</p>
                                                    {% endif %}
                                                </div>
                                            {% else %}
                                                <span class="text-gray-400">---</span>
                                            {% endif %}
                                        </dd>
                                    </div>
                                    <div>
                                        <dt class="text-xs font-semibold uppercase tracking-wide text-gray-400">Ancienne école</dt>
                                        <dd class="mt-1 text-sm text-gray-900">{{ student.lastSchool|default('---') }}</dd>
                                    </div>
                                </dl>
                            </div>

                            {% if student.personAuthorized %}
                                <div class="rounded-2xl border border-dashed border-indigo-200 bg-indigo-50/60 p-6 shadow-sm">
                                    <h4 class="text-base font-semibold text-indigo-800">Personnes autorisées à récupérer l'élève</h4>
                                    <p class="mt-2 text-sm text-indigo-700 leading-relaxed">{{ student.personAuthorized|nl2br }}</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Sidebar with additional info #}
        <div class="space-y-6">
            {# Quick Stats #}
            <div class="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-900">
                        {{ ux_icon('bi:graph-up', {class: 'w-5 h-5 mr-2 inline'}) }}
                        Statistiques
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-500">ID Étudiant</span>
                        <span class="text-sm font-mono text-gray-900 bg-gray-100 px-2 py-1 rounded">{{ student.id }}</span>
                    </div>

                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-500">Statut</span>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium
                                     {{ student.enable ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' }}">
                            {% if student.enable %}
                                {{ ux_icon('bi:check-circle-fill', {class: 'w-3 h-3 mr-1'}) }}
                                Actif
                            {% else %}
                                {{ ux_icon('bi:x-circle-fill', {class: 'w-3 h-3 mr-1'}) }}
                                Inactif
                            {% endif %}
                        </span>
                    </div>

                    {% if student.zip %}
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-500">Code Postal</span>
                            <span class="text-sm text-gray-900">{{ student.zip }}</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            {{ component('student_packages', { student: student }) }}
        </div>
    </div>

    {# Additional content sections can be added here #}
    <div class="mt-8 space-y-6">
        {# You can add more sections here for courses, payments, etc. #}
    </div>
{% endblock %}
