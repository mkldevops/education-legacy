{% trans_default_domain 'layout' %}

{# Symfony UX Twig Component for Period Dropdown #}
<div class="hidden sm:block relative" x-data="{ open: false }">
    <button type="button" 
            @click="open = !open"
            @click.away="open = false"
            class="flex items-center rounded-xl border-gray-200 bg-white hover:bg-gray-50 pl-4 pr-10 py-2.5 text-sm font-medium text-gray-700 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer">
        <svg class="h-4 w-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        <span>{{ this.selectedPeriod.name|default('header.periods.none_selected'|trans) }}</span>
        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
            <svg class="h-4 w-4 text-gray-500 transition-transform duration-200" 
                 :class="{ 'rotate-180': open }" 
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </div>
    </button>

    <!-- Dropdown Menu -->
    <div x-show="open" 
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 transform scale-100"
         x-transition:leave-end="opacity-0 transform scale-95"
         class="absolute right-0 z-50 mt-2 w-72 origin-top-right rounded-xl bg-white shadow-xl ring-1 ring-black/5 border border-gray-200">
        <div class="py-2 max-h-96 overflow-y-auto">
            {% if this.hasPeriods %}
                {% for period in this.periods %}
                    {% if period.id is defined %}
                        {% set active = this.isPeriodActive(period) %}
                        <a href="{{ path('app_period_switch', { 'id' : period.id }) }}"
                           @click="open = false"
                           class="flex items-center justify-between px-4 py-3 text-sm hover:bg-gradient-to-r hover:from-primary-50 hover:to-primary-100 transition-all duration-200 group {{ active ? 'bg-gradient-to-r from-primary-50 to-primary-100 text-primary-700' : 'text-gray-700 hover:text-primary-700' }}">
                            <div class="flex items-center">
                                {% if active %}
                                    <div class="w-2 h-2 rounded-full bg-primary-500 mr-3 animate-pulse"></div>
                                {% else %}
                                    <div class="w-2 h-2 rounded-full bg-gray-300 mr-3 group-hover:bg-primary-400 transition-colors duration-200"></div>
                                {% endif %}
                                <span class="font-medium">{{ period.name }}</span>
                            </div>
                            {% if active %}
                                <svg class="h-4 w-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            {% else %}
                                <svg class="h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            {% endif %}
                        </a>
                        {% if not loop.last %}
                            <hr class="border-gray-100">
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% else %}
                <div class="px-4 py-6 text-center">
                    <div class="flex items-center justify-center w-12 h-12 mx-auto mb-3 rounded-xl bg-red-50">
                        <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <p class="text-sm text-red-600 font-medium">{% trans %}header.periods.notfound{% endtrans %}</p>
                </div>
            {% endif %}
            
            {% if is_granted('ROLE_ADMIN') %}
                <hr class="border-gray-200 my-2">
                <a href="{{ path('app_admin_dashboard_index', {
                    'crudAction': 'index',
                    'crudControllerFqcn': 'App\\Controller\\Admin\\PeriodCrudController'
                }) }}"
                   @click="open = false"
                   class="flex items-center justify-between px-4 py-3 text-sm text-gray-600 hover:text-primary-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-primary-50 transition-all duration-200 group">
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-6 h-6 mr-3 rounded-lg bg-gray-100 group-hover:bg-primary-100 transition-colors duration-200">
                            <svg class="w-3 h-3 text-gray-500 group-hover:text-primary-600 transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                            </svg>
                        </div>
                        <span class="font-medium">{{ 'Manage Periods'|trans }}</span>
                    </div>
                    <svg class="h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            {% endif %}
        </div>
    </div>
</div>